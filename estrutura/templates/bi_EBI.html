{% extends "base.html" %}

{% block title %}Dashboard EBI{% endblock %}

{% block content %}
<style>
  .watermark{
    position:fixed; inset:0; pointer-events:none; z-index:1;
    font-size:1.4rem; color:#666;
  }
  .watermark span{
    position:absolute; white-space:nowrap; opacity:.12;
    transform:rotate(-30deg); user-select:none;
  }
</style>

<div id="wm" class="watermark"></div>

<script>
  (function(){
    const wm = document.getElementById('wm');
    const user = "{{ username|escapejs }}";
    // grade 8x8 (igual à antiga), sem CSS inline com {{ }}
    const rows = 8, cols = 8;
    for(let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){
        const s = document.createElement('span');
        s.textContent = user;
        s.style.top  = `${(r+1)*10}vh`;
        s.style.left = `${(c+1)*10}vw`;
        wm.appendChild(s);
      }
    }
  })();
</script>


<h2 style="text-align: center;">Dashboard EBI</h2>

<iframe
    title="Dashboard EBI"
    width="100%"
    height="750"
    src="https://app.powerbi.com/view?r=eyJrIjoiM2YyNDkxYmQtNWM1MC00Yjk4LWIyYTUtZWQ4M2I1ZWQ5MjIzIiwidCI6ImNmMzE3Y2ViLTA1M2EtNDYyMy04Y2RmLWU4NWM1NjgxNTdmOCJ9&pageName=03539e3353ee58f008b4"
    frameborder="0"
    allowfullscreen="true">
</iframe>

<script>
function showAlert(msg) {
    const alerta = document.createElement('div');
    alerta.style = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: yellow; padding: 1rem; font-weight: bold; border: 2px solid black; z-index: 9999;';
    alerta.innerHTML = msg;
    document.body.appendChild(alerta);

    setTimeout(() => {
        alerta.remove();
    }, 5000);
}

document.addEventListener('copy', function () {
    fetch("{% url 'auditoria_log' %}");
    showAlert(`⚠️ Copiar conteúdo é proibido!<br>Usuário: {{ username }}<br>Data e Hora: {{ data_hora }}`);
});

document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
    showAlert(`⚠️ Clique direito desabilitado!<br>Usuário: {{ username }}`);
});
</script>
{% endblock %}
